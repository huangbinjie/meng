# meng

ç”¨è¿‡å„ç§æ•°æ®æµåº“ä¹‹åï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰æœ‰ç‚¹çƒ¦ï¼Œä½†æ˜¯è¯´ä¸å‡ºä¸ºä»€ä¹ˆã€‚å…¶å®å°±æ˜¯ä»–ä»¬çš„çº¦æŸå’Œè§„èŒƒå¤ªå¤šäº†,åŠ ä¸Šå„ç§å„æ ·çš„ä¾èµ–,å¾ˆå®¹æ˜“äº§ç”Ÿ`javascript fatigue`, è¿™æ—¶å€™åè€Œå¾ˆæƒ³ç›´æ¥ä½¿ç”¨reactäº†ã€‚
æ•°æ®å°±å­˜åœ¨stateé‡Œé¢å¥½äº†ï¼Œé‚£ä¹ˆå‰©ä¸‹ä¸€ä¸ªé—®é¢˜å°±æ˜¯ç»„ä»¶ä¹‹é—´æ€ä¹ˆé€šè®¯ï¼ŒreactåŸç”Ÿçš„é€šè®¯æ–¹å¼(çˆ¶çº§ä¼ å›è°ƒ)ç¡®å®å¤ªæ¶å¿ƒäººäº†ï¼Œä¸ä»…è¦ä¼ ï¼Œè¿˜è¦å±‚å±‚ä¼ ã€‚é‚£ä¹ˆmengå°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚

## å®‰è£…

    npm i meng --save

## Usage

```js
  import Store, { lift, resource } from 'meng'
  //ç»„ä»¶çš„storeå¯ä»¥äº’ç›¸æ³¨å…¥ï¼Œè¿™é‡ŒæŠŠæ ¹storeæ³¨å…¥è¿›æ¥ï¼Œä½ å¯ä»¥æŠŠå…¨å±€å˜é‡ï¼Œæ¯”å¦‚ç”¨æˆ·ç™»å½•ä¹‹åçš„ä¿¡æ¯å­˜åœ¨è¿™é‡Œ Store.setState({user: userinfo})
  @resource(Store, "rootStore")
  //æ³¨å…¥ä¸€ä¸ªthunk, æ¥æ”¶propsä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªpromiseï¼Œç»„ä»¶mountedä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œç»„ä»¶propsæ¯æ¬¡å‘ç”Ÿæ”¹å˜çš„æ—¶å€™éƒ½ä¼šè°ƒç”¨ä¸€æ¬¡
  @resource(props => fetch(`/test/${props.params.tid}`), "field3")
  //æ³¨å…¥ä¸€ä¸ªthunkï¼Œæ²¡æœ‰å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªpromiseï¼Œç»„ä»¶mountedä¼šè°ƒç”¨ä¸€æ¬¡
  @resource(() => fetch("/test"), "field2")
  //ä¹Ÿå¯ä»¥ç»™ç»„ä»¶æ³¨å…¥ä»»æ„å€¼
  @resource("test", "field1")
  //åˆå§‹åŒ–åŸç”Ÿç»„ä»¶
  @lift({todos: []})
  //å»ºè®®ç»„ä»¶ä½¿ç”¨classå†™æ³•ï¼Œç»„ä»¶åå­—å¼€å¤´å¤§å†™
  class App extends React.Component {
    state = Store["App"].state
    render() {
      const { field1, field2, field3, todos } = this.state
      return <div>
        <Child data={todos}/>
      </div>
    }
  }

  @lift({todo: "test"})
  class Child extends React.Component {
    render() {
      const { data } = this.props
      const { todo } = this.state
      return <div onClick={this.clickHandle}>{data}</div>
    }
    clickHandle = e => this.setState({todo: "clicked"})
  }
```
## Api

### lift(initialState)

æŠŠæ™®é€šç»„ä»¶æå‡ä¸ºmengç»„ä»¶çš„æ–¹æ³•ï¼Œåªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºåˆå§‹åŒ–ç»„ä»¶çŠ¶æ€
ä¸ºäº†é˜²æ­¢æ¯æ¬¡propsæŠŠstateé‡Œçš„ç›¸åŒå±æ€§è¦†ç›–ï¼Œè€Œå¯¼è‡´æ²¡å¿…è¦çš„ä¿®æ”¹propsï¼Œæˆ‘æŠŠstateçš„ä¼˜å…ˆçº§è®¾å®šå¾—æ¯”propsé«˜ã€‚
æ‰€ä»¥æˆ‘å»ºè®®çš„mengç»„ä»¶æ˜¯æ— propsä¼ å‚çš„ï¼Œåªæœ‰`lift state`çš„ç»„ä»¶ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡propsä¼ å‚ï¼Œä½†æ˜¯å¦‚æœå’Œstateé‡å¤ï¼Œä¼šè¢«stateè¦†ç›–ï¼Œè¯·æ³¨æ„

### resource<T>(any|Observable|Promise|(props) => T , string|Function, [string|Function])

ç»™ç»„ä»¶æ³¨å…¥æ•°æ®æºï¼Œåªèƒ½ç»™å·²ç»liftçš„ç»„ä»¶ä½¿ç”¨
ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ¥æ”¶ä»»æ„å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯rxjsçš„Observable,ä¹Ÿå¯ä»¥æ˜¯promise, æ¨èä½¿ç”¨rxjsçš„ajaxæ–¹æ³•å¤„ç†æ¥å£æˆ–è€…fetchã€‚ä¸ºäº†å°†å£°æ˜å¼æ•°æ®æºè¿›è¡Œåˆ°åº•ï¼Œåœ¨2.0é‡Œæ–°å¢äº†ä¸€ä¸ªç±»å‹Functionï¼Œ
åœ¨æŸäº›åœºåˆæ¯”å¦‚éœ€è¦è·¯ç”±ä¸­çš„æŸä¸ªå‚æ•°ï¼Œè¿™ä¸ªæ—¶å€™ç»„ä»¶è¿˜æ²¡æœ‰åŠ è½½æ²¡æœ‰åŠæ³•è·å–è¿™ä¸ªå‚æ•°ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œmengä¼šåœ¨é«˜é˜¶ç»„ä»¶LiftåŠ è½½å®Œä¹‹åï¼ŒæŠŠpropsä¼ ç»™ä½ çš„å‡½æ•°
> å½“æ³¨å…¥çš„thunkå‡½æ•°ä¸æ¥æ”¶å‚æ•°çš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°åªä¼šåœ¨é«˜é˜¶ç»„ä»¶willmountedè°ƒç”¨ä¸€æ¬¡
> å½“æ³¨å…¥çš„thunkå‡½æ•°æ¥æ”¶å‚æ•°çš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°ä¸ä»…ä¼šåœ¨é«˜é˜¶ç»„ä»¶willmountedè°ƒç”¨ä¸€æ¬¡ï¼Œè¿˜ä¼šåœ¨propsæ¯æ¬¡å‘ç”Ÿæ”¹å˜çš„æ—¶å€™éƒ½ä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œæ³¨æ„liftåˆå§‹åŒ–çš„å˜é‡å«stateä¸æ˜¯props

ç¬¬äºŒä¸ªå‚æ•°æ˜¯å½“ç¬¬ä¸€ä¸ªå‚æ•°æˆåŠŸæ³¨å…¥çš„æ—¶å€™çš„å›è°ƒï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²åˆ™è¡¨ç¤ºä½œä¸ºå˜é‡æ³¨å…¥åˆ°ç»„ä»¶å¯¹åº”çš„Storeé‡Œï¼Œå¦‚æœæ˜¯å‡½æ•°ï¼Œåˆ™è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå¹¶æŠŠç»„ä»¶å¯¹åº”çš„storeå’Œè¿”å›å€¼ä¼ ç»™å‡½æ•°  
ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°æ³¨å…¥å¤±è´¥ä¹‹åçš„å›è°ƒï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²åˆ™è¡¨ç¤ºä½œä¸ºå˜é‡æ³¨å…¥åˆ°ç»„ä»¶å¯¹åº”çš„Storeé‡Œï¼Œå¦‚æœæ˜¯å‡½æ•°ï¼Œåˆ™è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå¹¶æŠŠç»„ä»¶å¯¹åº”çš„storeå’Œè¿”å›å€¼ä¼ ç»™å‡½æ•°

### Store

ç›¸å½“äºngçš„rootScopeï¼Œé‚£ä¹ˆä½ å¯èƒ½è¦é—®scopeå‘¢ï¼Œå¯¹çš„ï¼Œè¿™é‡Œçš„æ¯ä¸ªä½¿ç”¨liftæå‡è¿‡çš„ç»„ä»¶éƒ½æœ‰è‡ªå·±çš„storeï¼Œæˆ–è€…å«scopeéƒ½è¡Œã€‚
ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨`Store.ç»„ä»¶å`æ¥è®¿é—®mountedçš„ç»„ä»¶çš„çŠ¶æ€ã€‚ç»„ä»¶ä¹‹é—´çš„é€šè®¯ä¹Ÿæ˜¯è¿™ä¹ˆå®ç°çš„ï¼Œä½ å¯ä»¥`Store.ç»„ä»¶å.setState()`ç›´æ¥ä¿®æ”¹å¦ä¸€ä¸ªç»„ä»¶çš„çŠ¶æ€ï¼
æ¯ä¸ªstoreï¼ŒåŒ…æ‹¬æ ¹storeéƒ½æ˜¯`StoreConstructor`çš„å®ä¾‹ï¼Œå®ƒåŒ…å«ä»¥ä¸‹å±æ€§:

+ `state` æ¯ä¸ªstoreçš„çŠ¶æ€éƒ½å­˜åœ¨è¿™ä¸ªå®¹å™¨é‡Œé¢
+ `@@subject` æ¯ä¸ªstoreçš„äº‹ä»¶è§¦å‘å™¨ï¼Œå®ƒæ˜¯rxjsçš„Subjectï¼Œä¸æ‡‚çš„å¯ä»¥å¿½ç•¥
+ `setState` æ”¹å˜å½“å‰storeçš„æ–¹æ³•ï¼Œå®ƒå’Œreactçš„setStateæ–¹æ³•ä¸€æ ·ï¼Œç”šè‡³åŒ…æ‹¬å›è°ƒã€‚
+ `subscribe` è®¢é˜…è¿™ä¸ªstoreï¼Œè°ƒç”¨setStateä¼šè§¦å‘è¿™ä¸ªå‡½æ•°,ç”¨æ³•: `Store.App.subscribe(state => localStorage.setItem("cache": JSON.stringify(this.state)))`

æˆ‘æ”¹å˜äº†liftedç»„ä»¶çš„setStateæ–¹æ³•ï¼Œæ‰€ä»¥å¦‚æœä½ è¿˜åœ¨ç»„ä»¶é‡Œ`this.setState`ï¼Œå…¶å®å°±ç›¸å½“äº`Store.ç»„ä»¶å.setState()`ã€‚é‚£ä¹ˆä½ å¯èƒ½è¦è¯´æˆ‘å¦‚æœè¦å±€éƒ¨çŠ¶æ€æ€ä¹ˆåŠå•Šã€‚
å±€éƒ¨çŠ¶æ€å…¶å®ä¸ç¬¦åˆæˆ‘çš„æ€è·¯çš„ï¼ŒåŒ…æ‹¬reduxéƒ½æ¨èç”¨storeå–ä»£stateï¼Œå¦‚æœæ˜¯å°é—­çŠ¶æ€çš„ç»„ä»¶ï¼Œä½ å®Œå…¨å¯ä»¥ä¸liftå˜›ï¼Œå¦‚æœliftedè¿˜çŸ«æƒ…ä»€ä¹ˆï¼Œä¸€å®¶è€å°éƒ½å­˜storeå°±å¯¹äº†ã€‚
å¦‚æœä½ è¿˜æ˜¯å–œæ¬¢`this.state`ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç›´æ¥æŠŠstoreç»‘å®šåˆ°ä½ çš„stateä¸Šã€‚å¦‚æœæ˜¯statelessï¼Œä½ éœ€è¦ç»™statelessç»„ä»¶æŒ‡å®šdisplayNameã€‚

## è®¾è®¡æ€è·¯

æˆ‘çš„è®¾è®¡æ€è·¯éå¸¸å…ˆè¿›ï¼ŒåŸºæœ¬æ˜¯å°±æ˜¯æœªæ¥å‡ å¹´reactæ¶æ„çš„ä¸»è¦å‘å±•æ–¹å‘äº†ã€‚ğŸ˜‚
å…·ä½“è¯·å‚è€ƒæˆ‘çš„åšå®¢[å…³äºreactçš„æ•°æ®æµæ–°æ€è·¯](https://github.com/useroriented/useroriented.github.io/blob/master/coral/think-of-react-data-flow.md)
